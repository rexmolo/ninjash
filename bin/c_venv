#!/bin/bash
### Description: Create and activate Python virtual environments
### Usage: ninjash c_venv
### Example: ninjash c_venv

# ANSI colors
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
CYAN='\033[0;36m'
BLUE='\033[1;34m'
NC='\033[0m' # No Color

# Show Python version and path
echo -e "${GREEN}üêç Python info:${NC}"
python --version && which python
echo ""

# Check if virtual environment already exists
if [ -d ".venv" ]; then
  echo -e "${YELLOW}‚ö†Ô∏è  A virtual environment already exists at $(pwd)/.venv${NC}"

  # Check if it's currently activated
  if [ -n "$VIRTUAL_ENV" ] && [ "$VIRTUAL_ENV" = "$(pwd)/.venv" ]; then
    echo -e "${GREEN}‚úÖ The virtual environment is already activated.${NC}"
    echo -e "${CYAN}üëâ Current Python:${NC} $(which python)"
  else
    echo -e "${BLUE}‚ùì It is not activated.${NC}"
    read -p "Do you want to activate it? (yes/no): " choice
    case "$choice" in
      yes|y|Y )
        echo -e "${GREEN}‚úÖ Activating virtual environment...${NC}"
        echo -e "${YELLOW}(Type 'exit' to return to your original shell)${NC}"
        exec $SHELL -c "source .venv/bin/activate && exec $SHELL"
        ;;
      * )
        echo -e "${RED}Exiting without activation.${NC}"
        ;;
    esac
  fi
  exit 0
fi

# If no venv, ask to create one
echo -e "${YELLOW}No virtual environment found.${NC}"
read -p "Do you want to create one here? (yes/no): " choice
case "$choice" in
  yes|y|Y )
    echo -e "${GREEN}üì¶ Creating virtual environment...${NC}"
    python -m venv .venv
    echo -e "${GREEN}‚úÖ Virtual environment created at $(pwd)/.venv${NC}"
    echo -e "${GREEN}‚úÖ Activating virtual environment...${NC}"
    echo -e "${YELLOW}(Type 'exit' to return to your original shell)${NC}"
    exec $SHELL -c "source .venv/bin/activate && exec $SHELL"
    ;;
  * )
    echo -e "${RED}Exiting without creating.${NC}"
    exit 0
    ;;
esac

